#!/bin/zsh

# SÃ¦t hjem
hjem=$(pwd)/pirathark
startmappe=$hjem

helpfile=$hjem/.hjÃ¦lp.md

hjÃ¦lp() {
    glow -w 125 $helpfile
}

start() {
    clear
    cd $startmappe
    glow .intro.md
}

# OpgaverÃ¦kkefÃ¸lge
#export hxr=0
#export pape=0
#export lager=0
#export gemmested=0
#export gemtbesked=0
#export piratflag=0
#export abe=0
#export guldkiste=0
#export unicorn=0

opgave_array=(	"1"
		"2"
		"3"
		"4"
		)

opgave_solution=( "1"
		  "2"
		  "3"
		  "4"
		)



hvadnu() {
    if [[ $hxr != 1 ]]; then
	opgave=1
	if [[ $pape = 1 ]]; then
	  	opgave=$((opgave+1))
	  	if [[ $lager = 1 ]]; then
	    		opgave=$((opgave+1))
	    		if [[ $gemmested = 1 ]]; then
	      			opgave=$((opgave+1))
				if [[ $gemtbesked = 1 ]]; then
					opgave=$((opgave+1))
					if [[ $piratflag = 1 ]]; then
		  				opgave=$((opgave+1))
						if [[ $abe = 1 ]]; then
							opgave=$((opgave+1))
							if [[ $guldkiste = 1 ]]; then
								opgave=$((opgave+1))
								if [[ $unicorn = 1 ]]; then
									opgave=$((opgave+1))
									echo "Du er klar til at komme ombord pÃ¥ piratskibet!"
									return
			                    			fi
			                    		fi
		  				fi
					fi
				fi
			fi
	  	fi
	fi
	echo -e "# NÃ¦ste udfordring\n - Du skal ${opgave_array[$opgave]}"|glow
    else
	hxropg=1
	if [[ $IP == "192.168.1.44" ]]; then
		hxropg=$((hxropg+1))
		if [[ $kodeord == "sikkersystemTakoon" ]]; then
			hxropg=$((hxropg+1))
			# Til at tjekke op pÃ¥ captive portal
			$hjem/.check_ip.sh &> /dev/null &
			if [[ $blue_ship = 1 ]]; then
				hxropg=$((hxropg+1))
				if [[ $klo = 1 ]]; then
					hxropg=$((hxropg+1))
					if [[ $piratfisk = 1 ]]; then
						hxropg=$((hxropg+1))
					fi
				fi
			fi
		fi
	fi
	echo -e "# NÃ¦ste udfordring\n - Du skal ${hxr_array[$hxropg]}"|glow
    fi
}

cd() {
    if [[ "$@" == *"piratskibet" ]] || [[ "$@" == *"piratskibet/" ]]; then
	if [[ "$(hvadnu)" == "Du er klar til at komme ombord pÃ¥ piratskibet!" ]]; then
		export hxr=1
		export starttime=$(cat $hjem/.starttime)
		export endtime=$(date +%s)
		export duration=$(($endtime - $starttime))
		echo
		echo "Whoaa! Tillykke du er kommet ombord! Det tog dig $(date -d@$duration -u +%H:%M:%S)."
		echo 
		echo "Rejs dig op og sig AAAARH!"
		sleep 3
		startmappe=$hjem/Ã¸stmolen/piratskibet
		kortfilen=$startmappe/PiratSkib.md
		helpfile=$startmappe/.hackerhjÃ¦lp.md
		echo $(date +%s)>$startmappe/.starttime
		echo 
		echo -e "# Du har fÃ¥et et nyt kort\nSe det med kommandoen \`kort\`" | glow
		echo
		builtin cd "$@"
	elif [[ $hxr -eq 1 ]]; then
		builtin cd "$@"
		hvadnu
	else
		echo -e "# Du er ikke klar til at komme ombord!\n$(hvadnu)"|glow
	fi
    elif [[ "$@" == "gemmested" ]] || [[ "$@" == "gemmested/" ]]; then
        echo '
Fedt du slap vÃ¦k..!

Husk at lave variablen gemmested=1 med:
export gemmested=1'
    elif [[ -d pirathavn ]] && [[ "$@" == "pirathavn" ]] || [[ "$@" == "pirathavn/" ]]; then
	echo $(date +%s)>$hjem/.starttime
	echo
	echo "Velkommen til pirathavnen, tjek omgivelserne med: cat pirathavn"
	echo
	builtin cd "$@"
    else
        builtin cd "$@"
    fi
}

echo() {
	if [[ "$@" == "Skattekortet er begravet pÃ¥ Ã¸en Isolering" ]]; then
		builtin echo "$@"
		builtin echo 
		builtin echo "Hoved 2: Arrrh nej, det var ikke Isolering, men Loddetin - skriv det pirataspirant!"
		builtin echo
	elif [[ "$@" == "Skattekortet er begravet pÃ¥ Ã¸en Loddetin" ]]; then
		builtin echo
		builtin echo "Hoved 1: Fjumrehoveder! Det var da slet ikke en skat! Skriv i stedet: Skattekortet er blevet vÃ¦k"
		builtin echo
	elif [[ "$@" == "Skattekortet er blevet vÃ¦k" ]]; then
		builtin echo
		builtin echo -e "Du trÃ¦der lidt vÃ¦k, da abens tre hoveder begynder at rÃ¥be og skrige og bide efter hinanden.\n\nKort efter lÃ¸ber aben ud af dÃ¸ren."
		builtin echo
		builtin echo -e "Du kan nu sÃ¦tte variablen abe til 1 med kommandoen:\n\nexport abe=1"
		builtin echo 
		builtin echo -e "# BoboCocoLoco\nLiget af den trehovedede abe ligger og det er et skrÃ¦mmende og foruroligende syn. Dens tre hoveder er kastet tilbage i en uhyggelig vrangstilling, med Ã¥bne munde, der stadig ser ud til at rÃ¥be og skÃ¦nde, selv i dÃ¸den. Ã˜jnene er udtvÃ¦ret i en skrÃ¦mmende grimasse af smerte, og den kolde havbrise fÃ¥r dens pels til at bÃ¸lge som spÃ¸gelsesagtige skygger.\n\nDe omkringliggende mÃ¥ger er tavse og er flygtet vÃ¦k. Stilheden er kun afbrudt af de dystre bÃ¸lgers sagte klukken. Det er som om, Ã¸stmolen selv bÃ¦rer ar fra den trehovedede abes gruopvÃ¦kkende dÃ¸d, og det sender en kuldegysning ned ad ryggen pÃ¥ enhver, der tÃ¸r nÃ¦rme sig.\n\n">$hjem/Ã¸stmolen/trehovedetabe.md
		rm trehovedetabe.md
	elif [[ "$@" == "Skatteko"* ]]; then
		builtin echo
		builtin echo "Hoved $((1 + $RANDOM % 3)): Aaaarh! PrÃ¸v igen!"
		builtin echo 
	else
		builtin echo "$@"
	fi
}

alias piratflag='echo -e "# SÃ¥dan matroser....\n\n###I har nu fuldfÃ¸rt denne opgave og kan gÃ¥ videre. MÃ¥ vinden altid vÃ¦re i jeres sejl, og mÃ¥ skattejagterne aldrig ende!\n\nLykke og held! ðŸ´â€â˜ ï¸ðŸ’°\n\nSkriv \`export piratflag=1\` sÃ¥ gemmer du dine fremskridt.\n\nDu kan tjekke om dine fremskridt er gemt med \`echo \$piratflag\`" | glow'

# til vinduesopgaverne
cd $hjem/.hemsidan
node index.js &> /dev/null &
cd $hjem/..



















































